<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeekWise 2.3</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="ico/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Main Calendar -->
    <div class="calendar" id="main">
        <div class="calendar-header">
            <h2>Wochenplan</h2>
        </div>
        
        <!-- Mobile View (dynamically generated by app.js) -->
        <div class="day-tiles" id="dayTiles"></div>

        <!-- Desktop View (headers generated dynamically by app.js) -->
        <div class="desktop-scroll-wrapper" id="desktopScrollWrapper">
            <div class="weekdays" id="weekdayHeaders"></div>
            <div class="day-columns" id="dayColumns"></div>
        </div>
    </div>

    <!-- Floating Action Buttons (vertical stack, bottom-right) -->
    <button class="fab fab-extra" id="newBookingButton" style="display:none" aria-label="Neuer Termin">
        <span class="icon add"></span>
    </button>
    <button class="fab fab-top" id="icsButton" style="display:none" aria-label="Kalender-Export">
        <span class="icon calendar"></span>
    </button>
    <button class="fab fab-mid" id="printButton" style="display:none" aria-label="Drucken">
        <span class="icon print"></span>
    </button>
    <button class="fab fab-bottom" id="editButton" aria-label="Bearbeiten">
        <span class="icon edit"></span>
    </button>

    <!-- Print Options Popup -->
    <div class="print-popup" id="printPopup">
        <h4>Druckoptionen</h4>
        <label><input type="checkbox" id="printWithHeader" checked> Mit Kopfzeile</label>
        <label><input type="checkbox" id="printWithColors" checked> Mit Farben</label>
        <div class="form-group" style="margin-bottom:0">
            <label for="printCategory">Kategorie</label>
            <select id="printCategory">
                <option value="">Alle</option>
            </select>
        </div>
        <div class="form-group" style="margin-bottom:0">
            <label for="printOrientation">Ausrichtung</label>
            <select id="printOrientation">
                <option value="landscape">Querformat</option>
                <option value="portrait">Hochformat</option>
            </select>
        </div>
        <button type="button" onclick="executePrint()">Drucken</button>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h3>Login</h3>
            <div class="form-group">
                <input type="password" id="password" placeholder="Passwort" autocomplete="current-password">
            </div>
            <button type="button" onclick="login()">Anmelden</button>
            <button type="button" class="cancel-button" onclick="closeLoginModal()">Abbrechen</button>
        </div>
    </div>

    <!-- Booking Edit Modal -->
    <div class="modal" id="bookingModal">
        <div class="modal-content">
            <h3>Termin Details</h3>
            <form id="bookingForm">
                <div class="form-group">
                    <label for="bookingDay">Tag</label>
                    <select id="bookingDay" required>
                        <!-- populated dynamically by buildDaySelect() -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="bookingTitle">Titel</label>
                    <input type="text" id="bookingTitle" required>
                </div>
                <div class="form-group">
                    <label for="bookingLocation">Ort/Treffpunkt</label>
                    <input type="text" id="bookingLocation">
                </div>
                <div class="form-group">
                    <label>Zeitraum</label>
                    <div class="time-range-row">
                        <span>von</span>
                        <select id="bookingStart" required class="time-select"></select>
                        <span>bis</span>
                        <select id="bookingEnd" required class="time-select"></select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="bookingTrainer">Trainer/Verantwortliche (einer pro Zeile)</label>
                    <textarea id="bookingTrainer" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="bookingContact">Kontakt</label>
                    <input type="text" id="bookingContact">
                </div>
                <div class="form-group">
                    <label for="bookingLink">Link</label>
                    <input type="url" id="bookingLink" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label for="bookingDescription">Beschreibung</label>
                    <textarea id="bookingDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="bookingCategory">Kategorie</label>
                    <select id="bookingCategory">
                        <option value="default">Standard</option>
                    </select>
                </div>
                <div class="form-group" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
                    <button type="submit">Speichern</button>
                    <button type="button" class="duplicate-button" id="modalDuplicateButton" style="display:none">Duplizieren</button>
                    <button type="button" class="delete-button" id="modalDeleteButton" style="display:none">Löschen</button>
                    <button type="button" class="cancel-button" onclick="closeBookingModal()">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="optionsModal">
        <div class="modal-content settings-content">
            <h3>Einstellungen</h3>

            <!-- ── Zeitraum ── -->
            <div class="settings-section-divider">Zeitraum</div>

            <div class="form-group">
                <label for="calendarTitle">Titel</label>
                <input type="text" id="calendarTitle" value="Wochenplan">
            </div>

            <div class="form-group">
                <label>Modus</label>
                <div class="mode-toggle">
                    <label class="mode-option"><input type="radio" name="calendarMode" value="week" checked> Woche</label>
                    <label class="mode-option"><input type="radio" name="calendarMode" value="event"> Event</label>
                </div>
            </div>

            <div id="weekModeSection">
                <div class="form-group">
                    <label>Tage anzeigen</label>
                    <div id="hiddenDaysCheckboxes" class="day-checkboxes">
                        <!-- populated dynamically by buildHiddenDaysCheckboxes() -->
                    </div>
                </div>
            </div>

            <div id="eventModeSection" style="display:none">
                <div class="form-group">
                    <label for="eventStartDate">Startdatum</label>
                    <input type="date" id="eventStartDate">
                </div>
                <div class="form-group">
                    <label for="eventDayCount">Anzahl Tage</label>
                    <input type="number" id="eventDayCount" min="1" max="14" value="3">
                </div>
                <div class="form-group">
                    <label>Vorschau</label>
                    <div id="eventDayPreview" class="event-day-preview">—</div>
                </div>
            </div>

            <div class="form-group">
                <label>Zeitbereich</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <select id="startHour"></select>
                    <span>bis</span>
                    <select id="endHour"></select>
                </div>
            </div>

            <div class="form-group">
                <label class="inline-check"><input type="checkbox" id="hideEmptyDays"> Leere Tage ausblenden</label>
            </div>

            <!-- ── Darstellung ── -->
            <div class="settings-section-divider">Darstellung</div>

            <div class="form-group">
                <label>Layout</label>
                <div class="color-edit header-color-edit">
                    <div class="color-swatch" style="background-color: var(--primary)"></div>
                    <input type="text" value="Kopfbalken" readonly>
                </div>
                <div class="color-edit secondary-color-edit">
                    <div class="color-swatch" style="background-color: var(--secondary)"></div>
                    <input type="text" value="Sekundärfarbe (Standard)" readonly>
                </div>
            </div>

            <div class="form-group">
                <label>Kategorien</label>
                <div id="bookingColors"></div>
            </div>

            <!-- ── System ── -->
            <div class="settings-section-divider">System</div>

            <div class="form-group" id="icsSettingsSection">
                <label>Kalender-Export (ICS)</label>
                <label class="inline-check"><input type="checkbox" id="icsPublicCheckbox"> Öffentlich zugänglich (ohne Login)</label>
                <div style="margin-top: 8px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <button type="button" id="icsGenerateTokenBtn" onclick="generateIcsToken()">Neuen Token generieren</button>
                    <span id="icsTokenDisplay" class="ics-token-info"></span>
                </div>
                <div id="icsTokenHint" class="ics-token-info" style="margin-top: 4px;"></div>
            </div>

            <div class="form-group">
                <label>Export/Import</label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="button" onclick="exportBookings()">Termine exportieren</button>
                    <input type="file" id="importFile" style="display:none" accept=".json">
                    <button type="button" onclick="document.getElementById('importFile').click()">Termine importieren</button>
                </div>
            </div>

            <div class="form-group">
                <label>Passwort ändern</label>
                <input type="password" id="oldpwd" placeholder="Altes Passwort" autocomplete="current-password">
                <input type="password" id="newpwd" placeholder="Neues Passwort" autocomplete="new-password" style="margin-top: 4px;">
            </div>

            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                <button type="button" onclick="saveSettings()">Speichern</button>
                <button type="button" onclick="logout()" class="danger-button">Ausloggen</button>
                <button type="button" class="cancel-button" onclick="closeOptionsModal()">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- ICS Export Modal -->
    <div class="modal" id="icsModal">
        <div class="modal-content">
            <h3>Kalender-Export</h3>

            <div class="ics-section-divider">Filter</div>

            <div class="form-group">
                <label>Kategorien</label>
                <div id="icsCategoryChips" class="ics-filter-chips"></div>
            </div>

            <div class="form-group">
                <label>Tage</label>
                <div id="icsDayChips" class="ics-filter-chips"></div>
            </div>

            <div id="icsCounter" class="ics-counter"></div>

            <div class="ics-section-divider">Download</div>

            <div class="ics-link-row">
                <input type="text" id="icsDownloadUrl" readonly>
                <button type="button" id="icsCopyDownloadBtn">Kopieren</button>
                <button type="button" id="icsDownloadBtn">Download</button>
            </div>

            <div id="icsAboSection">
                <div class="ics-section-divider">Abo (Kalender-Abonnement)</div>
                <div class="ics-link-row">
                    <input type="text" id="icsAboUrl" readonly>
                    <button type="button" id="icsCopyAboBtn">Kopieren</button>
                </div>
                <div id="icsAboHint" class="ics-token-info">
                    Diesen Link in Google Calendar, Outlook oder Apple Kalender als Abo-URL einfügen.
                </div>
            </div>

            <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                <button type="button" class="cancel-button" onclick="closeIcsModal()">Schließen</button>
            </div>
        </div>
    </div>

    <!-- View Booking Modal -->
    <div class="modal" id="viewBookingModal">
        <div class="modal-content">
            <div class="view-booking-header">
                <h3 id="viewBookingTitle"></h3>
                <h4 id="viewBookingLocation"></h4>
                <div id="viewBookingTrainers" class="trainer-tags"></div>
            </div>
            <div id="viewBookingTime"></div>
            <div id="viewBookingContact" class="contact-info"></div>
            <div id="viewBookingDescription" class="description-box"></div>
            <div id="viewBookingLink"></div>
            <button type="button" class="cancel-button" onclick="closeViewBookingModal()">Schließen</button>
        </div>
    </div>

    <!-- Sidebar (Ablage) -->
    <div id="sidebar" class="sidebar-container">
        <button class="sidebar-toggle openbtn" onclick="toggleSidebar()" aria-label="Sidebar öffnen">
            <span class="icon chevron-left"></span>
        </button>
        <button class="sidebar-toggle closebtn" onclick="toggleSidebar()" aria-label="Sidebar schließen">
            <span class="icon chevron-right"></span>
        </button>
        <div id="contentSidebar" class="sidebar">
            <div class="weekday" id="Ablage">Ablage</div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
